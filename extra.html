<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extra Questions</title>
    <link rel="stylesheet" href="new-style.css">
    <style>
        .puzzle-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="logo.png" alt="VALENCY Logo" class="logo">
        <h2>Extra Questions</h2>
        
        <div class="puzzle-section">
            <h3>問題 1</h3>
            <div id="grid-inner-1"></div>
            <button onclick="checkPuzzle(1)">回答をチェック</button>
            <div id="message-area-1"></div>
        </div>

        <div class="puzzle-section">
            <h3>問題 2</h3>
            <div id="grid-inner-2"></div>
            <button onclick="checkPuzzle(2)">回答をチェック</button>
            <div id="message-area-2"></div>
        </div>
        
        <div id="all-clear-link" style="display: none; margin-top: 40px;">
            <a href="extra-clear.html" class="next-stage-button">全問正解！次のサイトへ進む</a>
        </div>
    </div>


    <script>
        // --- 1. 5問分のデータ定義 ---
        const puzzleData = [
            {height: 3, width: 4, numbers: [
                { row: 0, col: 0, value: 2, color: '#ffadad' },
                { row: 1, col: 1, value: 4, color: '#ffd6a5' },
                { row: 1, col: 3, value: 2, color: '#caffb6' },
                { row: 2, col: 0, value: 2, color: '#9bf6ff' },
                { row: 2, col: 2, value: 2, color: '#bdb2ff' }
            ],
            solution: new Set([
                "0,0-1,0",
                "0,1-0,2",
                "0,1-1,1",
                "0,2-0,3",
                "1,0-1,1",
                "1,2-1,3",
                "1,2-2,2",
                "1,3-2,3",
                "2,0-2,1",
                "2,1-2,2"
            ])},
          
            {height: 3, width: 4, numbers: [
                { row: 0, col: 0, value: 2, color: '#ffadad' },
                { row: 1, col: 1, value: 4, color: '#ffd6a5' },
                { row: 1, col: 3, value: 2, color: '#caffb6' },
                { row: 2, col: 0, value: 2, color: '#9bf6ff' },
                { row: 2, col: 2, value: 2, color: '#bdb2ff' }
            ],
            solution: new Set([
                "0,0-1,0",
                "0,1-0,2",
                "0,1-1,1",
                "0,2-0,3",
                "1,0-1,1",
                "1,2-1,3",
                "1,2-2,2",
                "1,3-2,3",
                "2,0-2,1",
                "2,1-2,2"
            ])},
        ];

        // --- 2. ゲームインスタンスの格納用配列 ---
        const gameInstances = [];

        // --- 3. 全問の正解ステータス ---
        let solvedStatus = new Array(puzzleData.length).fill(false);

        // --- 4. ページロード時の初期化処理 ---
        document.addEventListener('DOMContentLoaded', () => {
            puzzleData.forEach((data, index) => {
                const puzzleNumber = index + 1;
                const containerId = `grid-inner-${puzzleNumber}`;
                const messageId = `message-area-${puzzleNumber}`;

                // 5つの独立したゲームインスタンスを作成
                const game = new ValencyGame(data, containerId, messageId);
                gameInstances.push(game);
            });
        });

        // --- 5. チェックボタンが押されたときの処理 ---
        // (HTMLの onclick="checkPuzzle(N)" から呼び出される)
        function checkPuzzle(puzzleNumber) {
            const index = puzzleNumber - 1;
            const game = gameInstances[index];
            
            // 該当パズルの checkAnswer メソッドを実行
            const isCorrect = game.checkAnswer();

            if (isCorrect) {
                solvedStatus[index] = true; // 正解状態を保存
            }

            // 全問正解チェック
            const allSolved = solvedStatus.every(status => status === true);

            if (allSolved) {
                document.getElementById('all-clear-link').style.display = 'block';
            }
        }
    </script>
    
    <script src="new-game-logic.js"></script>
</body>
</html>
